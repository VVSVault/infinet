const Stripe = require('stripe');
require('dotenv').config({ path: '.env.local' });

// IMPORTANT: This uses your LIVE keys - real money will be charged!
const stripe = new Stripe(process.env.STRIPE_SECRET_KEY);

async function setupLiveProducts() {
  try {
    console.log('⚠️  WARNING: Setting up LIVE Stripe products - these will charge real money!\n');

    // Verify we're using live keys
    if (!process.env.STRIPE_SECRET_KEY.startsWith('sk_live_')) {
      console.error('❌ Not using live keys! Update your .env.local with live keys first.');
      process.exit(1);
    }

    console.log('Creating LIVE products...\n');

    // Create Starter Product
    console.log('Creating Starter tier ($10/month)...');
    const starterProduct = await stripe.products.create({
      name: 'Infinet Starter',
      description: '10,000 tokens per month - Perfect for trying out Infinet',
    });

    const starterPrice = await stripe.prices.create({
      product: starterProduct.id,
      unit_amount: 1000, // $10.00 in cents
      currency: 'usd',
      recurring: {
        interval: 'month',
      },
    });

    console.log(`✅ Starter tier created!`);
    console.log(`   Product ID: ${starterProduct.id}`);
    console.log(`   Price ID: ${starterPrice.id}\n`);

    // Create Premium Product
    console.log('Creating Premium tier ($50/month)...');
    const premiumProduct = await stripe.products.create({
      name: 'Infinet Premium',
      description: '50,000 tokens per month - Perfect for individuals and small teams',
    });

    const premiumPrice = await stripe.prices.create({
      product: premiumProduct.id,
      unit_amount: 5000, // $50.00 in cents
      currency: 'usd',
      recurring: {
        interval: 'month',
      },
    });

    console.log(`✅ Premium tier created!`);
    console.log(`   Product ID: ${premiumProduct.id}`);
    console.log(`   Price ID: ${premiumPrice.id}\n`);

    // Create Limitless Product
    console.log('Creating Limitless tier ($150/month)...');
    const limitlessProduct = await stripe.products.create({
      name: 'Infinet Limitless',
      description: '100,000 tokens per month - For power users and businesses',
    });

    const limitlessPrice = await stripe.prices.create({
      product: limitlessProduct.id,
      unit_amount: 15000, // $150.00 in cents
      currency: 'usd',
      recurring: {
        interval: 'month',
      },
    });

    console.log(`✅ Limitless tier created!`);
    console.log(`   Product ID: ${limitlessProduct.id}`);
    console.log(`   Price ID: ${limitlessPrice.id}\n`);

    // Output environment variables to add
    console.log('========================================');
    console.log('🎉 LIVE PRODUCTS CREATED SUCCESSFULLY!');
    console.log('========================================\n');
    console.log('Update these in your .env.local file:\n');
    console.log(`STRIPE_STARTER_PRICE_ID=${starterPrice.id}`);
    console.log(`STRIPE_PREMIUM_PRICE_ID=${premiumPrice.id}`);
    console.log(`STRIPE_LIMITLESS_PRICE_ID=${limitlessPrice.id}\n`);
    console.log('========================================');

    // Save to a file for convenience
    const fs = require('fs');
    const envContent = `
# LIVE Stripe Price IDs (Generated by setup script)
# ⚠️ THESE ARE LIVE - REAL MONEY WILL BE CHARGED!
STRIPE_STARTER_PRICE_ID=${starterPrice.id}
STRIPE_PREMIUM_PRICE_ID=${premiumPrice.id}
STRIPE_LIMITLESS_PRICE_ID=${limitlessPrice.id}
`;

    fs.writeFileSync('live-price-ids.txt', envContent);
    console.log('\n✅ Price IDs saved to live-price-ids.txt');
    console.log('\n⚠️  REMINDER: These are LIVE products - real payments will be processed!');

  } catch (error) {
    console.error('Error setting up products:', error);
    process.exit(1);
  }
}

// Add confirmation prompt
const readline = require('readline');
const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

console.log('⚠️  WARNING: You are about to create LIVE products in Stripe!');
console.log('Real money will be charged when customers subscribe.\n');

rl.question('Type "yes" to continue: ', (answer) => {
  if (answer.toLowerCase() === 'yes') {
    rl.close();
    setupLiveProducts();
  } else {
    console.log('Cancelled. No products were created.');
    rl.close();
    process.exit(0);
  }
});