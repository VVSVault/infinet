const Stripe = require('stripe');
require('dotenv').config({ path: '.env.local' });

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY);

async function setupProducts() {
  try {
    console.log('Setting up Stripe products...\n');

    // Create Starter Product
    console.log('Creating Starter tier...');
    const starterProduct = await stripe.products.create({
      name: 'Infinet Starter',
      description: '10,000 tokens per month - Perfect for trying out Infinet',
    });

    const starterPrice = await stripe.prices.create({
      product: starterProduct.id,
      unit_amount: 1000, // $10.00 in cents
      currency: 'usd',
      recurring: {
        interval: 'month',
      },
    });

    console.log(`✅ Starter tier created!`);
    console.log(`   Product ID: ${starterProduct.id}`);
    console.log(`   Price ID: ${starterPrice.id}\n`);

    // Create Premium Product
    console.log('Creating Premium tier...');
    const premiumProduct = await stripe.products.create({
      name: 'Infinet Premium',
      description: '50,000 tokens per month - Perfect for individuals and small teams',
    });

    const premiumPrice = await stripe.prices.create({
      product: premiumProduct.id,
      unit_amount: 5000, // $50.00 in cents
      currency: 'usd',
      recurring: {
        interval: 'month',
      },
    });

    console.log(`✅ Premium tier created!`);
    console.log(`   Product ID: ${premiumProduct.id}`);
    console.log(`   Price ID: ${premiumPrice.id}\n`);

    // Create Limitless Product
    console.log('Creating Limitless tier...');
    const limitlessProduct = await stripe.products.create({
      name: 'Infinet Limitless',
      description: '100,000 tokens per month - For power users and businesses',
    });

    const limitlessPrice = await stripe.prices.create({
      product: limitlessProduct.id,
      unit_amount: 15000, // $150.00 in cents
      currency: 'usd',
      recurring: {
        interval: 'month',
      },
    });

    console.log(`✅ Limitless tier created!`);
    console.log(`   Product ID: ${limitlessProduct.id}`);
    console.log(`   Price ID: ${limitlessPrice.id}\n`);

    // Output environment variables to add
    console.log('========================================');
    console.log('Add these to your .env.local file:');
    console.log('========================================\n');
    console.log(`STRIPE_STARTER_PRICE_ID=${starterPrice.id}`);
    console.log(`STRIPE_PREMIUM_PRICE_ID=${premiumPrice.id}`);
    console.log(`STRIPE_LIMITLESS_PRICE_ID=${limitlessPrice.id}\n`);
    console.log('========================================');

    // Save to a file for convenience
    const fs = require('fs');
    const envContent = `
# Stripe Price IDs (Generated by setup script)
STRIPE_STARTER_PRICE_ID=${starterPrice.id}
STRIPE_PREMIUM_PRICE_ID=${premiumPrice.id}
STRIPE_LIMITLESS_PRICE_ID=${limitlessPrice.id}
`;

    fs.writeFileSync('stripe-price-ids.txt', envContent);
    console.log('\n✅ Price IDs saved to stripe-price-ids.txt');

  } catch (error) {
    console.error('Error setting up products:', error);
    process.exit(1);
  }
}

setupProducts();